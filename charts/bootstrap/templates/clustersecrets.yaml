apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret
metadata:
  name: cluster-docker-secrets
spec:
  externalSecretName: cluster-docker-secrets
  namespaceSelectors:
    - matchLabels:
        tenant: approved
  externalSecretSpec:
    secretStoreRef:
      name: external-infra
      kind: ClusterSecretStore
    target:
      name: cluster-docker-secrets
      template:
        type: kubernetes.io/dockerconfigjson
        data:
          .dockerconfigjson: |
            {
              "auths": {
                {{ `{{ print .HOST_PUBLIC | quote }}` }}: {
                  "auth": {{ `{{ b64enc (print .USERNAME_PUBLIC ":" .PASSWORD_PUBLIC ) | quote }}` }}
                },
                {{ `{{ print .HOST_PRIVATE | quote }}` }}: {
                  "auth": {{ `{{ b64enc (print .USERNAME_PRIVATE ":" .PASSWORD_PRIVATE ) | quote }}` }}
                }
              }
            }
    data:
      - remoteRef:
          key: DOCKER_PRIVATE
          property:  username 
        secretKey: USERNAME_PRIVATE
      - remoteRef:
          key: DOCKER_PRIVATE
          property:  password 
        secretKey: PASSWORD_PRIVATE
      - remoteRef:
          key: DOCKER_PRIVATE
          property: host
        secretKey: HOST_PRIVATE
      - remoteRef:
          key: DOCKER_PUBLIC
          property:  username 
        secretKey: USERNAME_PUBLIC
      - remoteRef:
          key: DOCKER_PUBLIC
          property:  password 
        secretKey: PASSWORD_PUBLIC
      - remoteRef:
          key: DOCKER_PUBLIC
          property: host
        secretKey: HOST_PUBLIC
---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret
metadata:
  name: cluster-docker-public
spec:
  externalSecretName: cluster-docker-public
  namespaceSelectors:
    - matchLabels:
        tenant: approved
  externalSecretSpec:
    secretStoreRef:
      name: external-infra
      kind: ClusterSecretStore
    target:
      name: cluster-docker-public
      template:
        type: kubernetes.io/dockerconfigjson
        data:
          .dockerconfigjson: |
            {
              "auths": {
                {{ `{{ print .HOST | quote }}` }}: {
                  "auth": {{ `{{ b64enc (print .USERNAME ":" .PASSWORD ) | quote }}` }}
                }
              }
            }
    data:
      - remoteRef:
          key: DOCKER_PUBLIC
          property:  username 
        secretKey: USERNAME
      - remoteRef:
          key: DOCKER_PUBLIC
          property:  password 
        secretKey: PASSWORD
      - remoteRef:
          key: DOCKER_PUBLIC
          property: host
        secretKey: HOST
---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret
metadata:
  name: cluster-docker-private
spec:
  externalSecretName: cluster-docker-private
  namespaceSelectors:
    - matchLabels:
        tenant: approved
  externalSecretSpec:
    secretStoreRef:
      name: external-infra
      kind: ClusterSecretStore
    target:
      name: cluster-docker-private
      template:
        type: kubernetes.io/dockerconfigjson
        data:
          .dockerconfigjson: |
            {
              "auths": {
                {{ `{{ print .HOST | quote }}` }}: {
                  "auth": {{ `{{ b64enc (print .USERNAME ":" .PASSWORD ) | quote }}` }}
                }
              }
            }
    data:
      - remoteRef:
          key: DOCKER_PRIVATE
          property:  username 
        secretKey: USERNAME
      - remoteRef:
          key: DOCKER_PRIVATE
          property:  password 
        secretKey: PASSWORD
      - remoteRef:
          key: DOCKER_PRIVATE
          property: host
        secretKey: HOST
---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret
metadata:
  name: cluster-smtp-secrets
spec:
  externalSecretName: cluster-smtp-secrets
  namespaceSelectors:
    - matchLabels:
        tenant: approved
  externalSecretSpec:
    secretStoreRef:
      name: external-infra
      kind: ClusterSecretStore
    target:
      name: cluster-smtp-secrets
    data:
      - remoteRef:
          key: SMTP
          property: SMTP_HOST
        secretKey: SMTP_HOST
      - remoteRef:
          key: SMTP
          property: SMTP_PASSWORD
        secretKey: SMTP_PASSWORD
      - remoteRef:
          key: SMTP
          property: SMTP_PORT
        secretKey: SMTP_PORT
      - remoteRef:
          key: SMTP
          property: SMTP_SECURITY
        secretKey: SMTP_SECURITY
      - remoteRef:
          key: SMTP
          property: SMTP_USERNAME
        secretKey: SMTP_USERNAME
      - remoteRef:
          key: SMTP
          property: SMTP_FROM_DOMAIN
        secretKey: SMTP_FROM_DOMAIN
      - remoteRef:
          key: SMTP
          property: SMTP_FROM_EMAIL
        secretKey: SMTP_FROM_EMAIL
      - remoteRef:
          key: SMTP
          property: SMTP_FROM_USER
        secretKey: SMTP_FROM_USER
---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret
metadata:
  name: cluster-middleware-secrets
spec:
  externalSecretName: cluster-middleware-secrets
  namespaceSelectors:
    - matchLabels:
        tenant: approved
        client: t
  externalSecretSpec:
    secretStoreRef:
      name: kubernetes
      kind: ClusterSecretStore
    target:
      name: cluster-middleware-secrets
    data:
      - remoteRef:
          key: redis
          property: hostname
        secretKey: redishostname
      - remoteRef:
          key: redis
          property: url
        secretKey: redisurl
